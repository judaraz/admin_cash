<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyA3palpYZDFdNpBDIF564YsiOAN2dtbxzA",
    authDomain: "tic-tac-toe-87d49.firebaseapp.com",
    projectId: "tic-tac-toe-87d49"
};

const ADMIN_UIDS = ["pPICivnJ7ZafIfDeuhilCyg6kO22"];

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.login = async () => {
    await signInWithEmailAndPassword(
        auth,
        email.value,
        password.value
    );
};

onAuthStateChanged(auth, async user => {
    if (!user || !ADMIN_UIDS.includes(user.uid)) {
        return;
    }

    document.getElementById("login").style.display = "none";
    document.getElementById("panel").style.display = "block";

    const snap = await getDocs(collection(db, "users"));
    let rows = "";

    snap.forEach(doc => {
        const d = doc.data();
        rows += `
        <tr>
            <td>${doc.id}</td>
            <td>${d.username || "-"}</td>
            <td>${d.phone_number || "Not shared"}</td>
            <td>${d.reward_unlocked ? "Yes" : "No"}</td>
        </tr>`;
    });

    document.getElementById("tbody").innerHTML = rows;
});
</script>

<style>
body {
    font-family: system-ui, sans-serif;
    background: #020617;
    color: #fff;
    padding: 20px;
}
input, button {
    padding: 10px;
    margin: 6px 0;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
td, th {
    border: 1px solid #334155;
    padding: 8px;
}
</style>
</head>

<body>

<div id="login">
    <h3>Admin Login</h3>
    <input id="email" placeholder="Email"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
</div>

<div id="panel" style="display:none;">
    <h2>User List</h2>
    <table>
        <thead>
            <tr>
                <th>Telegram ID</th>
                <th>Username</th>
                <th>Phone</th>
                <th>Reward</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

</body>
</html>
